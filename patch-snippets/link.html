<script>
  if (window.ap && /AliApp\(AP\//ig.test(window.navigator.userAgent)) {
    document.addEventListener('click', function (e) {
      function composedPath(el) {
        var path = [];
        while (el) {
          path.push(el);
          if (el.tagName === 'HTML') {
            path.push(document);
            path.push(window);
            return path;
          }
          el = el.parentElement;
        }
      }

      var path = e.path || (e.composedPath && e.composedPath()) || composedPath(e.target);

      if (path) {
        Array.prototype.forEach.call(path, function (el) {
          if ('A' === el.tagName) {
            var href = '';

            href = el.getAttribute('data-href');

            if (!href) {
              href = el.getAttribute('href');
              el.setAttribute('data-href', href);
              el.removeAttribute('href');
            }

            var splitterIndex = href.indexOf('?');
            var url = href.slice(0, splitterIndex);
            var qs = href.slice(splitterIndex, href.length);
            var queryObject = ap.parseQueryString(qs);

            // 处理页面 spm
            // TODO: c?d?
            if (window.__UNIVERSAL_SPM__) {
              if (!queryObject.spm) {
                queryObject.spm = window.__UNIVERSAL_SPM__.getPageSPM().join('.');
              }
            }

            window.ap.pushWindow({
              url: url,
              data: queryObject,
              // 容器启动参数
              params: {
                showLoading: "YES",
                transparentTitle: "none",
                pullRefresh: "YES"
              }
            });
          }
        });
      }
    });
  }
</script>